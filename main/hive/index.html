<!doctype html><html lang=en dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Hive #  Iceberg supports reading and writing Iceberg tables through Hive by using a StorageHandler. Here is the current compatibility matrix for Iceberg Hive support:
   Feature Hive 2.x Hive 3.1.2     CREATE EXTERNAL TABLE ✔️ ✔️   CREATE TABLE ✔️ ✔️   DROP TABLE ✔️ ✔️   SELECT ✔️ (MapReduce and Tez) ✔️ (MapReduce and Tez)   INSERT INTO ✔️ (MapReduce only)️ ✔️ (MapReduce only)    Enabling Iceberg support in Hive #  Loading runtime jar #  To enable Iceberg support in Hive, the HiveIcebergStorageHandler and supporting classes need to be made available on Hive&rsquo;s classpath.">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content>
<meta property="og:description" content="The open table format for analytic datasets.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://samredai.github.io/iceberg-docs-prototype/main/hive/">
<title>Hive | Apache Iceberg</title>
<link rel=manifest href=/iceberg-docs-prototype/main/manifest.json>
<link rel=icon href=/iceberg-docs-prototype/main/favicon.png type=image/x-icon>
<link rel=stylesheet href=/iceberg-docs-prototype/main/book.min.a0d6a3836a25edf3324f09f7e93515c58ff9c3a34dd1ca31394f49166b2c75c9.css integrity="sha256-oNajg2ol7fMyTwn36TUVxY/5w6NN0coxOU9JFmssdck=" crossorigin=anonymous>
<script defer src=/iceberg-docs-prototype/main/flexsearch.min.js></script>
<script defer src=/iceberg-docs-prototype/main/en.search.min.6c326d9e82cf863a4a73a5c0e7b1a8f4798d40b8bbacb4bbf66289b6e291e530.js integrity="sha256-bDJtnoLPhjpKc6XA57Go9HmNQLi7rLS79mKJtuKR5TA=" crossorigin=anonymous></script>
<link rel=alternate type=application/rss+xml href=https://samredai.github.io/iceberg-docs-prototype/main/hive/index.xml title="Apache Iceberg">
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/iceberg-docs-prototype/main/><img src=/iceberg-docs-prototype/main/img/iceberg-logo-icon.png alt=Logo><span>Apache Iceberg</span>
</a>
<a href=../releases>
<img id=version-shield src=https://img.shields.io/badge/version-0.12.1-blue alt>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
<a href=https://github.com/apache/iceberg target=_blank>
<img src=https://samredai.github.io/iceberg-docs-prototype/main/img/GitHub-Mark.png class=top-external-icon>
</a>
<a href=https://join.slack.com/t/apache-iceberg/shared_invite/zt-tlv0zjz6-jGJEkHfb1~heMCJA3Uycrg target=_blank>
<img src=https://samredai.github.io/iceberg-docs-prototype/main/img/Slack_Mark_Web.png class=top-external-icon>
</a>
</div>
<ul>
<li class=book-section-flat>
<span>
<i class="fa fa-table fa-fw"></i>
Tables</span>
<ul>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/configuration/>
Configuration</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/evolution/>
Evolution</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/maintenance/>
Maintenance</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/partitioning/>
Partitioning</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/performance/>
Performance</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/reliability/>
Reliability</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/schemas/>
Schemas</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/getting-started/>
<i class="fa fa-star-o fa-fw"></i>
Spark</a>
<ul>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/spark-configuration/>
Configuration</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/spark-ddl/>
DDL</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/spark-procedures/>
Procedures</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/spark-queries/>
Queries</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/spark-structured-streaming/>
Structured Streaming</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/spark-writes/>
Writes</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/flink/>
<img src=../img/flink-logo.png class="navigation-icon fa-fw">Flink</a>
<ul>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/flink-connector/>
Flink Connector</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/hive/ class=active>
<img src=../img/hive-logo.png class="navigation-icon fa-fw">Hive</a>
<ul>
</ul>
</li>
<li class=book-section-flat>
<a href=https://trino.io/docs/current/connector/iceberg.html target=_blank>
<img src=../img/trino-logo.png class="navigation-icon fa-fw">
Trino
</a>
</li>
<li class=book-section-flat>
<a href=https://prestodb.io/docs/current/connector/iceberg.html target=_blank>
<img src=../img/prestodb-logo.png class="navigation-icon fa-fw">
PrestoDB
</a>
</li>
<li class=book-section-flat>
<span>
<i class="fa fa-handshake-o fa-fw"></i>
Integrations</span>
<ul>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/aws/>
AWS</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/jdbc/>
JDBC</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/nessie/>
Nessie</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>
<i class="fa fa-connectdevelop fa-fw"></i>
API</span>
<ul>
<li class=navigation-icon-pad>
<input type=checkbox id=section-3752dbeb9567711c46fb17da5ba1dc59 class=toggle>
<label for=section-3752dbeb9567711c46fb17da5ba1dc59 class="flex justify-between">
<a role=button>
Java</a>
</label>
<ul>
<li>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/java-api-quickstart/>
Quickstart</a>
</li>
<li>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/api/>
API</a>
</li>
<li>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/custom-catalog/>
Custom Catalog</a>
</li>
<li class=navigation-icon-pad>
<a href=/javadoc target=_blank>
JavaDoc
</a>
</li>
</ul>
</li>
<li class=navigation-icon-pad>
<input type=checkbox id=section-abdba265780fd6e49b6e57db73f8e23b class=toggle>
<label for=section-abdba265780fd6e49b6e57db73f8e23b class="flex justify-between">
<a role=button>
Python</a>
</label>
<ul>
<li>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/python-quickstart/>
Quickstart</a>
</li>
<li>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/python-api-intro/>
API</a>
</li>
<li>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/python-feature-support/>
Feature Support</a>
</li>
</ul>
</li>
</ul>
</li>
<li class="book-section-flat navigation-icon-pad">
<a href=https://samredai.github.io/iceberg-docs-prototype/main/community/>
Community</a>
<ul>
<li>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/blogs/>
Blogs</a>
</li>
<li>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/talks/>
Talks</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>
<i class="fa fa-object-ungroup fa-fw"></i>
Format</span>
<ul>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/spec/>
Spec</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/terms/>
Terms</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>
<i class="fa fa-wrench fa-fw"></i>
Project</span>
<ul>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/how-to-release/>
How To Release</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/releases/>
Releases</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/roadmap/>
Roadmap</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/security/>
Security</a>
</li>
<li class=navigation-icon-pad>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/trademarks/>
Trademarks</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<a href=https://samredai.github.io/iceberg-docs-prototype/main/releases/>
<i class="fa fa-code-fork fa-fw"></i>
Releases</a>
<ul>
<li class=navigation-icon-pad>
<a href=../../0.13.0/docs target=_blank>
0.13.0
</a>
</li>
<li class=navigation-icon-pad>
<a href=../../0.12.1/docs target=_blank>
0.12.1
</a>
</li>
<li class=navigation-icon-pad>
<a href=../../0.12.0/docs target=_blank>
0.12.0
</a>
</li>
</ul>
</li>
<li class=book-section-flat>
<span>
<img src=../img/asf.png class="navigation-icon fa-fw">ASF</span>
<ul>
<li class=navigation-icon-pad>
<a href=https://www.apache.org/licenses/ target=_blank>
License
</a>
</li>
<li class=navigation-icon-pad>
<a href=https://www.apache.org/security/ target=_blank>
Security
</a>
</li>
<li class=navigation-icon-pad>
<a href=https://www.apache.org/foundation/thanks.html target=_blank>
Sponsors
</a>
</li>
<li class=navigation-icon-pad>
<a href=https://www.apache.org/foundation/sponsorship.html target=_blank>
Donate
</a>
</li>
<li class=navigation-icon-pad>
<a href=https://www.apache.org/events/current-event.html target=_blank>
Events
</a>
</li>
</ul>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<link rel=stylesheet href=/iceberg-docs-prototype/main/fontawesome/css/font-awesome.min.css>
<label for=menu-control>
<img src=/iceberg-docs-prototype/main/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Hive</strong>
<label for=toc-control>
<img src=/iceberg-docs-prototype/main/svg/toc.svg class=book-icon alt="Table of Contents">
</label>
</div>
<aside class="hidden clearfix">
<nav id=TableOfContents>
<ul>
<li><a href=#enabling-iceberg-support-in-hive>Enabling Iceberg support in Hive</a>
<ul>
<li><a href=#loading-runtime-jar>Loading runtime jar</a></li>
<li><a href=#enabling-support>Enabling support</a></li>
</ul>
</li>
<li><a href=#catalog-management>Catalog Management</a>
<ul>
<li><a href=#global-hive-catalog>Global Hive catalog</a></li>
<li><a href=#custom-iceberg-catalogs>Custom Iceberg catalogs</a></li>
</ul>
</li>
<li><a href=#ddl-commands>DDL Commands</a>
<ul>
<li><a href=#create-external-table>CREATE EXTERNAL TABLE</a></li>
<li><a href=#create-table>CREATE TABLE</a></li>
<li><a href=#drop-table>DROP TABLE</a></li>
</ul>
</li>
<li><a href=#querying-with-sql>Querying with SQL</a>
<ul>
<li><a href=#configurations>Configurations</a></li>
<li><a href=#select>SELECT</a></li>
</ul>
</li>
<li><a href=#writing-with-sql>Writing with SQL</a>
<ul>
<li><a href=#configurations-1>Configurations</a></li>
<li><a href=#insert-into>INSERT INTO</a></li>
</ul>
</li>
<li><a href=#type-compatibility>Type compatibility</a>
<ul>
<li><a href=#hive-type-to-iceberg-type>Hive type to Iceberg type</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
</header>
<article class=markdown>
<h1 id=hive>
Hive
<a class=anchor href=#hive>#</a>
</h1>
<p>Iceberg supports reading and writing Iceberg tables through <a href=https://hive.apache.org>Hive</a> by using a <a href=https://cwiki.apache.org/confluence/display/Hive/StorageHandlers>StorageHandler</a>.
Here is the current compatibility matrix for Iceberg Hive support:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Hive 2.x</th>
<th>Hive 3.1.2</th>
</tr>
</thead>
<tbody>
<tr>
<td>CREATE EXTERNAL TABLE</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>CREATE TABLE</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>DROP TABLE</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>SELECT</td>
<td>✔️ (MapReduce and Tez)</td>
<td>✔️ (MapReduce and Tez)</td>
</tr>
<tr>
<td>INSERT INTO</td>
<td>✔️ (MapReduce only)️</td>
<td>✔️ (MapReduce only)</td>
</tr>
</tbody>
</table>
<h2 id=enabling-iceberg-support-in-hive>
Enabling Iceberg support in Hive
<a class=anchor href=#enabling-iceberg-support-in-hive>#</a>
</h2>
<h3 id=loading-runtime-jar>
Loading runtime jar
<a class=anchor href=#loading-runtime-jar>#</a>
</h3>
<p>To enable Iceberg support in Hive, the <code>HiveIcebergStorageHandler</code> and supporting classes need to be made available on Hive&rsquo;s classpath.
These are provided by the <code>iceberg-hive-runtime</code> jar file.
For example, if using the Hive shell, this can be achieved by issuing a statement like so:</p>
<pre tabindex=0><code>add jar /path/to/iceberg-hive-runtime.jar;
</code></pre><p>There are many others ways to achieve this including adding the jar file to Hive&rsquo;s auxiliary classpath so it is available by default.
Please refer to Hive&rsquo;s documentation for more information.</p>
<h3 id=enabling-support>
Enabling support
<a class=anchor href=#enabling-support>#</a>
</h3>
<p>If the Iceberg storage handler is not in Hive&rsquo;s classpath, then Hive cannot load or update the metadata for an Iceberg table when the storage handler is set.
To avoid the appearance of broken tables in Hive, Iceberg will not add the storage handler to a table unless Hive support is enabled.
The storage handler is kept in sync (added or removed) every time Hive engine support for the table is updated, i.e. turned on or off in the table properties.
There are two ways to enable Hive support: globally in Hadoop Configuration and per-table using a table property.</p>
<h4 id=hadoop-configuration>
Hadoop configuration
<a class=anchor href=#hadoop-configuration>#</a>
</h4>
<p>To enable Hive support globally for an application, set <code>iceberg.engine.hive.enabled=true</code> in its Hadoop configuration.
For example, setting this in the <code>hive-site.xml</code> loaded by Spark will enable the storage handler for all tables created by Spark.</p>
<p>!!! Warning
Starting with Apache Iceberg <code>0.11.0</code>, when using Hive with Tez you also have to disable vectorization (<code>hive.vectorized.execution.enabled=false</code>).</p>
<h4 id=table-property-configuration>
Table property configuration
<a class=anchor href=#table-property-configuration>#</a>
</h4>
<p>Alternatively, the property <code>engine.hive.enabled</code> can be set to <code>true</code> and added to the table properties when creating the Iceberg table.
Here is an example of doing it programmatically:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>Catalog catalog <span style=color:#f92672>=</span> <span style=color:#f92672>...;</span>
Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> tableProperties <span style=color:#f92672>=</span> Maps<span style=color:#f92672>.</span><span style=color:#a6e22e>newHashMap</span><span style=color:#f92672>();</span>
tableProperties<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>TableProperties<span style=color:#f92672>.</span><span style=color:#a6e22e>ENGINE_HIVE_ENABLED</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>);</span> <span style=color:#75715e>// engine.hive.enabled=true
</span><span style=color:#75715e></span>catalog<span style=color:#f92672>.</span><span style=color:#a6e22e>createTable</span><span style=color:#f92672>(</span>tableId<span style=color:#f92672>,</span> schema<span style=color:#f92672>,</span> spec<span style=color:#f92672>,</span> tableProperties<span style=color:#f92672>);</span>
</code></pre></div><p>The table level configuration overrides the global Hadoop configuration.</p>
<h2 id=catalog-management>
Catalog Management
<a class=anchor href=#catalog-management>#</a>
</h2>
<h3 id=global-hive-catalog>
Global Hive catalog
<a class=anchor href=#global-hive-catalog>#</a>
</h3>
<p>From the Hive engine&rsquo;s perspective, there is only one global data catalog that is defined in the Hadoop configuration in the runtime environment.
In contrast, Iceberg supports multiple different data catalog types such as Hive, Hadoop, AWS Glue, or custom catalog implementations.
Iceberg also allows loading a table directly based on its path in the file system. Those tables do not belong to any catalog.
Users might want to read these cross-catalog and path-based tables through the Hive engine for use cases like join.</p>
<p>To support this, a table in the Hive metastore can represent three different ways of loading an Iceberg table,
depending on the table&rsquo;s <code>iceberg.catalog</code> property:</p>
<ol>
<li>The table will be loaded using a <code>HiveCatalog</code> that corresponds to the metastore configured in the Hive environment if no <code>iceberg.catalog</code> is set</li>
<li>The table will be loaded using a custom catalog if <code>iceberg.catalog</code> is set to a catalog name (see below)</li>
<li>The table can be loaded directly using the table&rsquo;s root location if <code>iceberg.catalog</code> is set to <code>location_based_table</code></li>
</ol>
<p>For cases 2 and 3 above, users can create an overlay of an Iceberg table in the Hive metastore,
so that different table types can work together in the same Hive environment.
See <a href=#create-external-table>CREATE EXTERNAL TABLE</a> and <a href=#create-table>CREATE TABLE</a> for more details.</p>
<h3 id=custom-iceberg-catalogs>
Custom Iceberg catalogs
<a class=anchor href=#custom-iceberg-catalogs>#</a>
</h3>
<p>To globally register different catalogs, set the following Hadoop configurations:</p>
<table>
<thead>
<tr>
<th>Config Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>iceberg.catalog.&lt;catalog_name>.type</td>
<td>type of catalog: <code>hive</code>, <code>hadoop</code>, or left unset if using a custom catalog</td>
</tr>
<tr>
<td>iceberg.catalog.&lt;catalog_name>.catalog-impl</td>
<td>catalog implementation, must not be null if type is empty</td>
</tr>
<tr>
<td>iceberg.catalog.&lt;catalog_name>.&lt;key></td>
<td>any config key and value pairs for the catalog</td>
</tr>
</tbody>
</table>
<p>Here are some examples using Hive CLI:</p>
<p>Register a <code>HiveCatalog</code> called <code>another_hive</code>:</p>
<pre tabindex=0><code>SET iceberg.catalog.another_hive.type=hive;
SET iceberg.catalog.another_hive.uri=thrift://example.com:9083;
SET iceberg.catalog.another_hive.clients=10;
SET iceberg.catalog.another_hive.warehouse=hdfs://example.com:8020/warehouse;
</code></pre><p>Register a <code>HadoopCatalog</code> called <code>hadoop</code>:</p>
<pre tabindex=0><code>SET iceberg.catalog.hadoop.type=hadoop;
SET iceberg.catalog.hadoop.warehouse=hdfs://example.com:8020/warehouse;
</code></pre><p>Register an AWS <code>GlueCatalog</code> called <code>glue</code>:</p>
<pre tabindex=0><code>SET iceberg.catalog.glue.catalog-impl=org.apache.iceberg.aws.GlueCatalog;
SET iceberg.catalog.glue.warehouse=s3://my-bucket/my/key/prefix;
SET iceberg.catalog.glue.lock-impl=org.apache.iceberg.aws.glue.DynamoLockManager;
SET iceberg.catalog.glue.lock.table=myGlueLockTable;
</code></pre><h2 id=ddl-commands>
DDL Commands
<a class=anchor href=#ddl-commands>#</a>
</h2>
<h3 id=create-external-table>
CREATE EXTERNAL TABLE
<a class=anchor href=#create-external-table>#</a>
</h3>
<p>The <code>CREATE EXTERNAL TABLE</code> command is used to overlay a Hive table &ldquo;on top of&rdquo; an existing Iceberg table.
Iceberg tables are created using either a <a href=./javadoc/master/index.html?org/apache/iceberg/catalog/Catalog.html><code>Catalog</code></a>,
or an implementation of the <a href=./javadoc/master/index.html?org/apache/iceberg/Tables.html><code>Tables</code></a> interface,
and Hive needs to be configured accordingly to operate on these different types of table.</p>
<h4 id=hive-catalog-tables>
Hive catalog tables
<a class=anchor href=#hive-catalog-tables>#</a>
</h4>
<p>As described before, tables created by the <code>HiveCatalog</code> with Hive engine feature enabled are directly visible by the Hive engine, so there is no need to create an overlay.</p>
<h4 id=custom-catalog-tables>
Custom catalog tables
<a class=anchor href=#custom-catalog-tables>#</a>
</h4>
<p>For a table in a registered catalog, specify the catalog name in the statement using table property <code>iceberg.catalog</code>.
For example, the SQL below creates an overlay for a table in a <code>hadoop</code> type catalog named <code>hadoop_cat</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SET</span> iceberg.<span style=color:#66d9ef>catalog</span>.hadoop_cat.<span style=color:#66d9ef>type</span><span style=color:#f92672>=</span>hadoop;
<span style=color:#66d9ef>SET</span> iceberg.<span style=color:#66d9ef>catalog</span>.hadoop_cat.warehouse<span style=color:#f92672>=</span>hdfs:<span style=color:#f92672>//</span>example.com:<span style=color:#ae81ff>8020</span><span style=color:#f92672>/</span>hadoop_cat;

<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>EXTERNAL</span> <span style=color:#66d9ef>TABLE</span> database_a.table_a
STORED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span>
TBLPROPERTIES (<span style=color:#e6db74>&#39;iceberg.catalog&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;hadoop_cat&#39;</span>);
</code></pre></div><p>When <code>iceberg.catalog</code> is missing from both table properties and the global Hadoop configuration, <code>HiveCatalog</code> will be used as default.</p>
<h4 id=path-based-hadoop-tables>
Path-based Hadoop tables
<a class=anchor href=#path-based-hadoop-tables>#</a>
</h4>
<p>Iceberg tables created using <code>HadoopTables</code> are stored entirely in a directory in a filesystem like HDFS.
These tables are considered to have no catalog.
To indicate that, set <code>iceberg.catalog</code> property to <code>location_based_table</code>. For example:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>EXTERNAL</span> <span style=color:#66d9ef>TABLE</span> table_a 
STORED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span> 
<span style=color:#66d9ef>LOCATION</span> <span style=color:#e6db74>&#39;hdfs://some_bucket/some_path/table_a&#39;</span>
TBLPROPERTIES (<span style=color:#e6db74>&#39;iceberg.catalog&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;location_based_table&#39;</span>);
</code></pre></div><h3 id=create-table>
CREATE TABLE
<a class=anchor href=#create-table>#</a>
</h3>
<p>Hive also supports directly creating a new Iceberg table through <code>CREATE TABLE</code> statement. For example:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> database_a.table_a (
  id bigint, name string
) PARTITIONED <span style=color:#66d9ef>BY</span> (
  dept string
) STORED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span>;
</code></pre></div><p>!!! Note
to Hive, the table appears to be unpartitioned although the underlying Iceberg table is partitioned.</p>
<p>!!! Note
Due to the limitation of Hive <code>PARTITIONED BY</code> syntax, if you use Hive <code>CREATE TABLE</code>,
currently you can only partition by columns, which is translated to Iceberg identity partition transform.
You cannot partition by other Iceberg partition transforms such as <code>days(timestamp)</code>.
To create table with all partition transforms, you need to create the table with other engines like Spark or Flink.</p>
<h4 id=custom-catalog-table>
Custom catalog table
<a class=anchor href=#custom-catalog-table>#</a>
</h4>
<p>You can also create a new table that is managed by a custom catalog.
For example, the following code creates a table in a custom Hadoop catalog:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SET</span> iceberg.<span style=color:#66d9ef>catalog</span>.hadoop_cat.<span style=color:#66d9ef>type</span><span style=color:#f92672>=</span>hadoop;
<span style=color:#66d9ef>SET</span> iceberg.<span style=color:#66d9ef>catalog</span>.hadoop_cat.warehouse<span style=color:#f92672>=</span>hdfs:<span style=color:#f92672>//</span>example.com:<span style=color:#ae81ff>8020</span><span style=color:#f92672>/</span>hadoop_cat;

<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> database_a.table_a (
  id bigint, name string
) PARTITIONED <span style=color:#66d9ef>BY</span> (
  dept string
) STORED <span style=color:#66d9ef>BY</span> <span style=color:#e6db74>&#39;org.apache.iceberg.mr.hive.HiveIcebergStorageHandler&#39;</span>
TBLPROPERTIES (<span style=color:#e6db74>&#39;iceberg.catalog&#39;</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;hadoop_cat&#39;</span>);
</code></pre></div><p>!!! Warning
If the table to create already exists in the custom catalog, this will create a managed overlay table.
This means technically you can omit the <code>EXTERNAL</code> keyword when creating an overlay table.
However, this is <strong>not recommended</strong> because creating managed overlay tables could pose a risk
to the shared data files in case of accidental drop table commands from the Hive side,
which would unintentionally remove all the data in the table.</p>
<h3 id=drop-table>
DROP TABLE
<a class=anchor href=#drop-table>#</a>
</h3>
<p>Tables can be dropped using the <code>DROP TABLE</code> command:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> [<span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span>] <span style=color:#66d9ef>table_name</span> [PURGE];
</code></pre></div><p>You can configure purge behavior through global Hadoop configuration or Hive metastore table properties:</p>
<table>
<thead>
<tr>
<th>Config key</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>external.table.purge</td>
<td>true</td>
<td>if all data and metadata should be purged in a table by default</td>
</tr>
</tbody>
</table>
<p>Each Iceberg table&rsquo;s default purge behavior can also be configured through Iceberg table properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>gc.enabled</td>
<td>true</td>
<td>if all data and metadata should be purged in the table by default</td>
</tr>
</tbody>
</table>
<p>When changing <code>gc.enabled</code> on the Iceberg table via <code>UpdateProperties</code>, <code>external.table.purge</code> is also updated on HMS table accordingly.
When setting <code>external.table.purge</code> as a table prop during Hive <code>CREATE TABLE</code>, <code>gc.enabled</code> is pushed down accordingly to the Iceberg table properties.
This makes sure that the 2 properties are always consistent at table level between Hive and Iceberg.</p>
<p>!!! Warning
Changing <code>external.table.purge</code> via Hive <code>ALTER TABLE SET TBLPROPERTIES</code> does not update <code>gc.enabled</code> on the Iceberg table.
This is a limitation on Hive 3.1.2 because the <code>HiveMetaHook</code> doesn&rsquo;t have all the hooks for alter tables yet.</p>
<h2 id=querying-with-sql>
Querying with SQL
<a class=anchor href=#querying-with-sql>#</a>
</h2>
<p>Here are the features highlights for Iceberg Hive read support:</p>
<ol>
<li><strong>Predicate pushdown</strong>: Pushdown of the Hive SQL <code>WHERE</code> clause has been implemented so that these filters are used at the Iceberg <code>TableScan</code> level as well as by the Parquet and ORC Readers.</li>
<li><strong>Column projection</strong>: Columns from the Hive SQL <code>SELECT</code> clause are projected down to the Iceberg readers to reduce the number of columns read.</li>
<li><strong>Hive query engines</strong>: Both the MapReduce and Tez query execution engines are supported.</li>
</ol>
<h3 id=configurations>
Configurations
<a class=anchor href=#configurations>#</a>
</h3>
<p>Here are the Hadoop configurations that one can adjust for the Hive reader:</p>
<table>
<thead>
<tr>
<th>Config key</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>iceberg.mr.reuse.containers</td>
<td>false</td>
<td>if Avro reader should reuse containers</td>
</tr>
<tr>
<td>iceberg.mr.case.sensitive</td>
<td>true</td>
<td>if the query is case-sensitive</td>
</tr>
</tbody>
</table>
<h3 id=select>
SELECT
<a class=anchor href=#select>#</a>
</h3>
<p>You should now be able to issue Hive SQL <code>SELECT</code> queries and see the results returned from the underlying Iceberg table, for example:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> table_a;
</code></pre></div><h2 id=writing-with-sql>
Writing with SQL
<a class=anchor href=#writing-with-sql>#</a>
</h2>
<h3 id=configurations-1>
Configurations
<a class=anchor href=#configurations-1>#</a>
</h3>
<p>Here are the Hadoop configurations that one can adjust for the Hive writer:</p>
<table>
<thead>
<tr>
<th>Config key</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>iceberg.mr.commit.table.thread.pool.size</td>
<td>10</td>
<td>the number of threads of a shared thread pool to execute parallel commits for output tables</td>
</tr>
<tr>
<td>iceberg.mr.commit.file.thread.pool.size</td>
<td>10</td>
<td>the number of threads of a shared thread pool to execute parallel commits for files in each output table</td>
</tr>
</tbody>
</table>
<h3 id=insert-into>
INSERT INTO
<a class=anchor href=#insert-into>#</a>
</h3>
<p>Hive supports the standard single-table <code>INSERT INTO</code> operation:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> table_a <span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#ae81ff>1</span>);
<span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> table_a <span style=color:#66d9ef>SELECT</span> ...;
</code></pre></div><p>Multi-table insert is also supported, but it will not be atomic and are committed one table at a time. Partial changes will be visible during the commit process and failures can leave partial changes committed. Changes within a single table will remain atomic.</p>
<p>Here is an example of inserting into multiple tables at once in Hive SQL:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>FROM</span> customers
    <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> target1 <span style=color:#66d9ef>SELECT</span> customer_id, first_name
    <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> target2 <span style=color:#66d9ef>SELECT</span> last_name, customer_id;
</code></pre></div><h2 id=type-compatibility>
Type compatibility
<a class=anchor href=#type-compatibility>#</a>
</h2>
<p>Hive and Iceberg support different set of types. Iceberg can perform type conversion automatically, but not for all combinations,
so you may want to understand the type conversion in Iceberg in prior to design the types of columns in your tables.
You can enable auto-conversion through Hadoop configuration (not enabled by default):</p>
<table>
<thead>
<tr>
<th>Config key</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>iceberg.mr.schema.auto.conversion</td>
<td>false</td>
<td>if Hive should perform type auto-conversion</td>
</tr>
</tbody>
</table>
<h3 id=hive-type-to-iceberg-type>
Hive type to Iceberg type
<a class=anchor href=#hive-type-to-iceberg-type>#</a>
</h3>
<p>This type conversion table describes how Hive types are converted to the Iceberg types.
The conversion applies on both creating Iceberg table and writing to Iceberg table via Hive.</p>
<table>
<thead>
<tr>
<th>Hive</th>
<th>Iceberg</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>short</td>
<td>integer</td>
<td>auto-conversion</td>
</tr>
<tr>
<td>byte</td>
<td>integer</td>
<td>auto-conversion</td>
</tr>
<tr>
<td>integer</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>long</td>
<td>long</td>
<td></td>
</tr>
<tr>
<td>float</td>
<td>float</td>
<td></td>
</tr>
<tr>
<td>double</td>
<td>double</td>
<td></td>
</tr>
<tr>
<td>date</td>
<td>date</td>
<td></td>
</tr>
<tr>
<td>timestamp</td>
<td>timestamp without timezone</td>
<td></td>
</tr>
<tr>
<td>timestamplocaltz</td>
<td>timestamp with timezone</td>
<td>Hive 3 only</td>
</tr>
<tr>
<td>interval_year_month</td>
<td></td>
<td>not supported</td>
</tr>
<tr>
<td>interval_day_time</td>
<td></td>
<td>not supported</td>
</tr>
<tr>
<td>char</td>
<td>string</td>
<td>auto-conversion</td>
</tr>
<tr>
<td>varchar</td>
<td>string</td>
<td>auto-conversion</td>
</tr>
<tr>
<td>string</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>binary</td>
<td>binary</td>
<td></td>
</tr>
<tr>
<td>decimal</td>
<td>decimal</td>
<td></td>
</tr>
<tr>
<td>struct</td>
<td>struct</td>
<td></td>
</tr>
<tr>
<td>list</td>
<td>list</td>
<td></td>
</tr>
<tr>
<td>map</td>
<td>map</td>
<td></td>
</tr>
<tr>
<td>union</td>
<td></td>
<td>not supported</td>
</tr>
</tbody>
</table>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
<aside class=book-toc>
<div class=book-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#enabling-iceberg-support-in-hive>Enabling Iceberg support in Hive</a>
<ul>
<li><a href=#loading-runtime-jar>Loading runtime jar</a></li>
<li><a href=#enabling-support>Enabling support</a></li>
</ul>
</li>
<li><a href=#catalog-management>Catalog Management</a>
<ul>
<li><a href=#global-hive-catalog>Global Hive catalog</a></li>
<li><a href=#custom-iceberg-catalogs>Custom Iceberg catalogs</a></li>
</ul>
</li>
<li><a href=#ddl-commands>DDL Commands</a>
<ul>
<li><a href=#create-external-table>CREATE EXTERNAL TABLE</a></li>
<li><a href=#create-table>CREATE TABLE</a></li>
<li><a href=#drop-table>DROP TABLE</a></li>
</ul>
</li>
<li><a href=#querying-with-sql>Querying with SQL</a>
<ul>
<li><a href=#configurations>Configurations</a></li>
<li><a href=#select>SELECT</a></li>
</ul>
</li>
<li><a href=#writing-with-sql>Writing with SQL</a>
<ul>
<li><a href=#configurations-1>Configurations</a></li>
<li><a href=#insert-into>INSERT INTO</a></li>
</ul>
</li>
<li><a href=#type-compatibility>Type compatibility</a>
<ul>
<li><a href=#hive-type-to-iceberg-type>Hive type to Iceberg type</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
</main>
</body>
</html>